#!/usr/bin/env python3
# Template exploit tim aezakmi_POLIBATAM
import requests 

from requests.compat import urljoin, quote

def url_builder(target: list, payload: str, protocol="http://", encode=False) -> dict:
    # create http url for the list
    result = ["".join([protocol, i]) for i in target]    

    if encode:
        result = {target[i]:urljoin(v, quote(payload)) for i, v in enumerate(result)}
    else:
        result = {target[i]:urljoin(v, payload) for i, v in enumerate(result)}
    
    return result

def get_list_player():
    URL = "https://ctf-gemastik.ub.ac.id/api/user"
    res = requests.get(URL).json()
    return [i for i in res['data']]

class Exploit:

    def __init__(self, target: dict):
        self.target = target

    def run_exploit(self) -> str:
        # example 
        res_code = dict()
        for i in self.target.keys():
            print(f"[+] Request target : {i}")
            res_code[i] = requests.get(self.target[i]).status_code
        return res_code


if __name__ == "__main__":
    """
    # example usage
    target = ["youtube. com", "google.com"]
    payload = "/aezakmi/'oke"
    protocol = "https://"
    encode = False

    res = url_builder(target, payload, protocol, encode)
    test = Exploit(res)
    print(test.run_exploit())
    """

    target = get_list_player()
    target_list_ip = [i['ip'] for i in target]
    print(target_list_ip)
